<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>â‚¦1M Breakout</title>

<style>
:root{
  --bg:#0b0d10;
  --card:#14171c;
  --border:#1f242c;
  --muted:#9aa4b2;
  --text:#e9edf3;
  --accent:#6ee7d8;
  --win:#22c55e;
  --loss:#ef4444;
}

*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;}

h1{font-weight:500;margin:0}
small{color:var(--muted)}

.wrap{padding:28px;max-width:1300px;margin:auto}

.top{
display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:18px
}

button{
border:0;background:#fff;color:#000;
border-radius:999px;padding:8px 14px;
font-weight:500;cursor:pointer
}

input{
background:#0f1217;color:var(--text);
border:1px solid var(--border);
border-radius:10px;padding:7px 10px;
font-weight:400;
}

.cardbar{display:flex;gap:14px;flex-wrap:wrap;margin:18px 0}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:16px;
padding:14px 16px;
min-width:170px
}

.card h3{
margin:0 0 4px 0;
font-size:11px;
letter-spacing:.06em;
font-weight:500;
color:var(--muted)
}

.card .val{
font-size:20px;
font-weight:500
}

.progress{
height:6px;background:#0c0f14;border-radius:999px;overflow:hidden;margin-top:8px
}
.bar{height:100%;background:linear-gradient(90deg,#6ee7d8,#60a5fa)}

table{
width:100%;border-collapse:separate;border-spacing:0 10px
}

thead th{
text-align:left;font-size:11px;color:var(--muted);font-weight:500
}

tbody tr{
background:var(--card);
border:1px solid var(--border)
}

tbody td{
padding:10px
}

.badge.win{color:var(--win)}
.badge.loss{color:var(--loss)}

.status{margin-top:10px;color:var(--muted);font-size:12px}
</style>
</head>

<body>
<div class="wrap">

<div class="top">
  <div>
    <h1>â‚¦1M Breakout</h1>
    <small>Headies & Harry â€“ Google Sheets backend Â· breakeven = balance vs â‚¦1,000,000</small>
  </div>

  <div style="display:flex;gap:10px">
    <input id="startBal" type="number" value="1170000" title="Current balance"/>
    <button onclick="loadData()">Reload</button>
    <button onclick="addRow()">Add Game Day</button>
  </div>
</div>

<div class="cardbar">

  <div class="card">
    <h3>TOTAL PLAYED DAYS</h3>
    <div class="val" id="totalDays">0</div>
  </div>

  <div class="card">
    <h3>TOTAL WINS</h3>
    <div class="val" id="totalWins">0</div>
  </div>

  <div class="card">
    <h3>HEADIES WIN RATE</h3>
    <div class="val" id="headiesRate">0%</div>
  </div>

  <div class="card">
    <h3>HARRY WIN RATE</h3>
    <div class="val" id="harryRate">0%</div>
  </div>

  <div class="card">
    <h3>BREAKEVEN PROGRESS</h3>
    <div class="val" id="beTxt">0 / 10</div>
    <div class="progress"><div id="beBar" class="bar" style="width:0%"></div></div>
  </div>

  <div class="card">
    <h3>CURRENT BALANCE</h3>
    <div class="val" id="balTxt">â‚¦0</div>
  </div>

</div>

<table>
<thead>
<tr>
<th>#</th>
<th>Date</th>
<th>Headies Stake</th>
<th>Headies Odds</th>
<th>Harry Stake</th>
<th>Harry Odds</th>
<th>Total Return</th>
<th>Win?</th>
<th>Winner</th>
<th>Notes</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="status" id="status">Loadingâ€¦</div>

</div>

<script>
/* ðŸ”´ PUT YOUR OWN DEPLOYED WEB APP URL HERE */
const API = "https://script.google.com/macros/s/AKfycbxD59C5mDEVAumJy-O4NyE54QNdq2ZEN05wy3KhsJrlOlEMmoYyy5yrRKW1eqT9LGTW/exec";

const TARGET = 1000000;
const UNIT = 100000;

let data = [];

function money(n){
  return "â‚¦" + Number(n||0).toLocaleString();
}

async function loadData(){
  document.getElementById("status").textContent="Loadingâ€¦";
  const r = await fetch(API);
  const j = await r.json();
  data = j.data || [];
  render();
}

function render(){

  const tbody = document.getElementById("rows");
  tbody.innerHTML="";

  let wins=0;
  let hWin=0, hTot=0, haWin=0, haTot=0;
  let cumulative = 0;

  const startBalance = Number(document.getElementById("startBal").value || 0);

  data.forEach((r,i)=>{

    const totalStake =
      (Number(r.HeadiesStake||0)+Number(r.HarryStake||0));

    const totalReturn = Number(r.TotalReturn||0);

    const pl = totalReturn - totalStake;

    cumulative += pl;

    const balNow = startBalance + cumulative;

    const winClass =
      totalStake>0 && pl>0 ? "win" :
      totalStake>0 && pl<0 ? "loss" : "";

    const winTxt =
      totalStake>0 && pl>0 ? "WIN" :
      totalStake>0 && pl<0 ? "LOSS" : "â€“";

    if(pl>0) wins++;

    if(r.HeadiesStake>0){
      hTot++; if(pl>0) hWin++;
    }
    if(r.HarryStake>0){
      haTot++; if(pl>0) haWin++;
    }

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${i+1}</td>
      <td><input type="date" value="${r.Date||""}" onchange="save(${r._rowNumber},this,'Date')"></td>
      <td><input type="number" value="${r.HeadiesStake||""}" onchange="save(${r._rowNumber},this,'HeadiesStake')"></td>
      <td><input type="number" step="0.01" value="${r.HeadiesOdds||""}" onchange="save(${r._rowNumber},this,'HeadiesOdds')"></td>
      <td><input type="number" value="${r.HarryStake||""}" onchange="save(${r._rowNumber},this,'HarryStake')"></td>
      <td><input type="number" step="0.01" value="${r.HarryOdds||""}" onchange="save(${r._rowNumber},this,'HarryOdds')"></td>
      <td><input type="number" value="${r.TotalReturn||""}" onchange="save(${r._rowNumber},this,'TotalReturn')"></td>
      <td class="badge ${winClass}">${winTxt}</td>
      <td>
        <input value="${r.Winner||""}" onchange="save(${r._rowNumber},this,'Winner')">
      </td>
      <td>
        <input value="${r.Notes||""}" onchange="save(${r._rowNumber},this,'Notes')">
      </td>
    `;

    tbody.appendChild(tr);
  });

  document.getElementById("totalDays").textContent = data.length;
  document.getElementById("totalWins").textContent = wins;

  document.getElementById("headiesRate").textContent =
    hTot? Math.round(hWin/hTot*100)+"%":"0%";

  document.getElementById("harryRate").textContent =
    haTot? Math.round(haWin/haTot*100)+"%":"0%";

  const finalBalance = startBalance + cumulative;

  const beUnits = Math.min(
    10,
    Math.max(0, Math.floor((finalBalance - TARGET) / UNIT))
  );

  document.getElementById("beTxt").textContent = `${beUnits} / 10`;
  document.getElementById("beBar").style.width = (beUnits/10*100)+"%";
  document.getElementById("balTxt").textContent = money(finalBalance);

  document.getElementById("status").textContent="Loaded";
}

async function save(row,el,field){

  const payload = {_rowNumber: row};
  payload[field] = el.value;

  await fetch(API,{
    method:"POST",
    body:JSON.stringify(payload)
  });

  loadData();
}

async function addRow(){
  await fetch(API,{
    method:"POST",
    body:JSON.stringify({})
  });
  loadData();
}

loadData();
</script>

</body>
</html>
