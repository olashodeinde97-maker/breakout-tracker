<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>₦1M Breakout</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg:#0b0b0d;
  --card:#151518;
  --line:#222;
  --text:#fff;
  --muted:#9aa0a6;
  --accent:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:linear-gradient(180deg,#0b0b0d,#0f1115);
  color:var(--text);
  padding:28px;
}
h1{margin:0 0 6px 0;font-size:26px}
.sub{color:var(--muted);margin-bottom:18px}

.topbar{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  margin-bottom:18px;
}

.card{
  background:linear-gradient(180deg,#16171a,#111214);
  border-radius:16px;
  padding:14px 18px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  min-width:150px;
}

.cards{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-bottom:20px;
}

.card h4{
  margin:0;
  font-size:11px;
  letter-spacing:.08em;
  color:var(--muted);
  font-weight:700;
}
.card .v{
  margin-top:6px;
  font-size:22px;
  font-weight:800;
}

.progress{
  height:8px;
  background:#1e1f24;
  border-radius:999px;
  overflow:hidden;
  margin-top:8px;
}
.bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#6cffd1,#4dd6ff);
  transition:width .3s ease;
}

input,select{
  background:#0f1014;
  border:1px solid #1f2026;
  border-radius:10px;
  color:#fff;
  padding:6px 8px;
  width:100%;
}

button{
  background:#fff;
  color:#000;
  border:none;
  padding:8px 14px;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
}

button.secondary{
  background:#1a1b20;
  color:#fff;
}

table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 8px;
  font-size:13px;
}

th{
  text-align:left;
  color:var(--muted);
  font-size:11px;
  letter-spacing:.08em;
  padding:0 6px;
}

td{
  background:#121317;
  padding:8px 6px;
}

tr td:first-child{border-radius:12px 0 0 12px}
tr td:last-child{border-radius:0 12px 12px 0}

.win{color:#55ffc8;font-weight:800}
.loss{color:#ff6b6b;font-weight:800}

.small{
  font-size:11px;
  color:var(--muted);
  margin-top:6px;
}

.rightControls{
  margin-left:auto;
  display:flex;
  gap:10px;
  align-items:center;
}
</style>
</head>

<body>

<h1>₦1M Breakout</h1>
<div class="sub">
Headies & Harry · Shared tracker (Google Sheets backend) ·
Breakeven progress = net ₦100k units (losses reduce it)
</div>

<div class="topbar">

  <div class="cards">

    <div class="card">
      <h4>TOTAL PLAYED DAYS</h4>
      <div class="v" id="totalDays">0</div>
    </div>

    <div class="card">
      <h4>TOTAL WINS OVERALL</h4>
      <div class="v" id="totalWins">0</div>
    </div>

    <div class="card">
      <h4>HEADIES WIN RATE</h4>
      <div class="v" id="headiesWR">0%</div>
    </div>

    <div class="card">
      <h4>HARRY WIN RATE</h4>
      <div class="v" id="harryWR">0%</div>
    </div>

    <div class="card">
      <h4>BREAKEVEN PROGRESS</h4>
      <div class="v"><span id="beText">0</span> / 10</div>
      <div class="progress"><div class="bar" id="beBar"></div></div>
    </div>

    <div class="card">
      <h4>CURRENT BALANCE</h4>
      <div class="v" id="currentBalance">₦0</div>
    </div>

  </div>

  <div class="rightControls">
    <input id="startingInput" type="number" style="width:120px" title="Starting capital">
    <button class="secondary" onclick="loadData()">Reload</button>
    <button onclick="addRow()">Add Game Day</button>
  </div>

</div>

<table>
<thead>
<tr>
<th>#</th>
<th>Date</th>
<th>Headies Stake</th>
<th>Headies Odds</th>
<th>Harry Stake</th>
<th>Harry Odds</th>
<th>Total Stake</th>
<th>Total Return</th>
<th>P / L</th>
<th>Cumulative</th>
<th>Balance</th>
<th>Win?</th>
<th>Winner</th>
<th>Counts in 10?</th>
<th>Notes</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="small" id="status">Status: loading…</div>

<script>
/* ==============================
   CONFIG
============================== */

const API =
"https://script.google.com/macros/s/AKfycbxD59C5mDEVAumJy-O4NyE54QNdq2ZEN05wy3KhsJrlOlEMmoYyy5yrRKW1eqT9LGTW/exec";

const BASELINE = 1000000;   // ₦1M breakeven target
const UNIT     = 100000;   // ₦100k per unit
const TARGET_UNITS = 10;

/* ==============================
   STATE
============================== */

let STARTING_CAPITAL = 1170000;
let sheetRows = [];

/* ==============================
   UTIL
============================== */

function n(v){ return Number(v)||0; }
function money(v){
  return "₦" + n(v).toLocaleString();
}

/* ==============================
   LOAD
============================== */

async function loadData(){
  document.getElementById("status").textContent="Status: loading…";

  const r = await fetch(API);
  const j = await r.json();
  sheetRows = j.data || [];

  render();
  document.getElementById("status").textContent="Status: loaded";
}

/* ==============================
   SAVE
============================== */

let saveTimer=null;

function queueSave(row){
  clearTimeout(saveTimer);
  saveTimer=setTimeout(()=>saveRow(row),400);
}

async function saveRow(row){
  await fetch(API,{
    method:"POST",
    body:JSON.stringify(row)
  });
  document.getElementById("status").textContent="Status: saved";
}

/* ==============================
   UI
============================== */

function addRow(){
  sheetRows.push({
    Date:"",
    HeadiesStake:"",
    HeadiesOdds:"",
    HarryStake:"",
    HarryOdds:"",
    TotalReturn:"",
    Winner:"",
    Notes:""
  });
  render();
}

function render(){

  const tbody=document.getElementById("rows");
  tbody.innerHTML="";

  let cumulative=0;
  let wins=0;
  let headiesWins=0, harryWins=0;
  let headiesPlayed=0, harryPlayed=0;
  let days=0;

  let beUnits=0;

  sheetRows.forEach((r,idx)=>{

    const hs=n(r.HeadiesStake);
    const ho=n(r.HeadiesOdds);
    const rs=n(r.HarryStake);
    const ro=n(r.HarryOdds);
    const ret=n(r.TotalReturn);

    const totalStake=hs+rs;
    const pl=ret-totalStake;

    cumulative+=pl;

    const balanceNow=STARTING_CAPITAL+cumulative;

    const netVsBase = balanceNow - BASELINE;
    beUnits = Math.min(
      TARGET_UNITS,
      Math.floor(Math.max(0, netVsBase) / UNIT)
    );

    if(totalStake>0) days++;

    if(ret>0 && pl>0) wins++;

    if(r.Winner==="Headies"){headiesWins++; headiesPlayed++;}
    else if(r.Winner==="Harry"){harryWins++; harryPlayed++;}
    else if(r.Winner==="Both"){
      headiesWins++; harryWins++;
      headiesPlayed++; harryPlayed++;
    }else if(r.Winner==="None"){
      headiesPlayed++; harryPlayed++;
    }

    const tr=document.createElement("tr");

    tr.innerHTML=`
      <td>${idx+1}</td>
      <td><input type="date" value="${r.Date||""}"></td>
      <td><input type="number" value="${r.HeadiesStake||""}"></td>
      <td><input type="number" step="0.01" value="${r.HeadiesOdds||""}"></td>
      <td><input type="number" value="${r.HarryStake||""}"></td>
      <td><input type="number" step="0.01" value="${r.HarryOdds||""}"></td>
      <td>${money(totalStake)}</td>
      <td><input type="number" value="${r.TotalReturn||""}"></td>
      <td class="${pl>=0?"win":"loss"}">${money(pl)}</td>
      <td>${money(cumulative)}</td>
      <td>${money(balanceNow)}</td>
      <td class="${pl>=0?"win":"loss"}">${pl>=0?"WIN":"LOSS"}</td>
      <td>
        <select>
          <option value=""></option>
          <option>Headies</option>
          <option>Harry</option>
          <option>Both</option>
          <option>None</option>
        </select>
      </td>
      <td>${pl>0?"YES":"—"}</td>
      <td><input value="${r.Notes||""}"></td>
    `;

    const inputs=tr.querySelectorAll("input,select");

    inputs[0].oninput=e=>update(idx,"Date",e.target.value);
    inputs[1].oninput=e=>update(idx,"HeadiesStake",e.target.value);
    inputs[2].oninput=e=>update(idx,"HeadiesOdds",e.target.value);
    inputs[3].oninput=e=>update(idx,"HarryStake",e.target.value);
    inputs[4].oninput=e=>update(idx,"HarryOdds",e.target.value);
    inputs[5].oninput=e=>update(idx,"TotalReturn",e.target.value);
    inputs[6].value=r.Winner||"";
    inputs[6].onchange=e=>update(idx,"Winner",e.target.value);
    inputs[7].oninput=e=>update(idx,"Notes",e.target.value);

    tbody.appendChild(tr);
  });

  document.getElementById("totalDays").textContent=days;
  document.getElementById("totalWins").textContent=wins;

  document.getElementById("headiesWR").textContent=
    headiesPlayed?Math.round(headiesWins/headiesPlayed*100)+"%":"0%";

  document.getElementById("harryWR").textContent=
    harryPlayed?Math.round(harryWins/harryPlayed*100)+"%":"0%";

  document.getElementById("beText").textContent=beUnits;
  document.getElementById("beBar").style.width=(beUnits/10*100)+"%";

  document.getElementById("currentBalance").textContent=
    money(STARTING_CAPITAL+cumulative);
}

function update(i,key,val){
  sheetRows[i][key]=val;
  sheetRows[i]._rowNumber=sheetRows[i]._rowNumber || null;
  queueSave(sheetRows[i]);
  render();
}

/* ==============================
   STARTING CAPITAL INPUT
============================== */

const startInput=document.getElementById("startingInput");
startInput.value=STARTING_CAPITAL;

startInput.onchange=()=>{
  STARTING_CAPITAL=n(startInput.value);
  render();
};

/* ==============================
   INIT
============================== */

loadData();
</script>

</body>
</html>
